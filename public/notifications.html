<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thông báo - Nexus</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="chat-style.css" /> </head>
  <body data-theme="dark" style="overflow: auto;">
    
    <nav class="navbar glass-header">
      <div class="nav-left"><div class="logo" onclick="location.href='/home.html'">Nexus</div></div>
      <div class="nav-center">
        <a href="/home.html" class="nav-item"><i class="fas fa-home"></i></a>
        <a href="/friends.html" class="nav-item"><i class="fas fa-user-friends"></i></a>
        <a href="/chat.html" class="nav-item"><i class="fas fa-comment-alt"></i></a>
        <a href="#" class="nav-item active"><i class="fas fa-bell"></i></a>
      </div>
    </nav>

    <div class="main-content" style="margin-top: 80px; padding: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">
        <h2 style="color: white; margin-bottom: 20px;">Thông báo mới</h2>
        <div id="notification-list">
            <div style="text-align:center; color:#888;">Đang tải...</div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const token = localStorage.getItem("token");
            if(!token) location.href = '/index.html';

            try {
                const res = await fetch('/api/notifications', { headers: { Authorization: `Bearer ${token}` } });
                const notis = await res.json();
                
                const list = document.getElementById("notification-list");
                list.innerHTML = "";

                if(notis.length === 0) {
                    list.innerHTML = '<div style="text-align:center; color:#888;">Không có thông báo nào.</div>';
                    return;
                }

                notis.forEach(n => {
                    const div = document.createElement("div");
                    div.className = "user-item"; // Dùng lại class cũ cho đẹp
                    div.style.background = "rgba(255,255,255,0.05)";
                    div.style.marginBottom = "10px";
                    
                    div.innerHTML = `
                        <div class="user-avatar"><img src="${n.avatar || 'https://ui-avatars.com/api/?name=U'}" style="width:40px;height:40px;border-radius:50%"></div>
                        <div class="user-info" style="flex:1; margin-left:15px;">
                            <div class="user-name" style="color:white;font-weight:bold">${n.nickname || n.username}</div>
                            <div class="user-preview" style="color:#ccc">Đã gửi lời mời kết bạn.</div>
                        </div>
                        <div class="actions">
                            <button onclick="acceptFriend(${n.id})" style="background:#22c55e; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer">Chấp nhận</button>
                        </div>
                    `;
                    list.appendChild(div);
                });

            } catch(e) {
                console.error(e);
                document.getElementById("notification-list").innerHTML = '<div style="color:red">Lỗi tải thông báo.</div>';
            }
        });

        async function acceptFriend(reqId) {
            const token = localStorage.getItem("token");
            await fetch('/api/friends/accept', {
                method: 'POST',
                headers: { "Content-Type": "application/json", Authorization: `Bearer ${token}` },
                body: JSON.stringify({ requestId: reqId })
            });
            alert("Đã chấp nhận!");
            location.reload();
        }
    </script>
  </body>
</html>
